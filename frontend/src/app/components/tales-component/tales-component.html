<div class="tales-container">
  <!-- Header Section -->
  <header class="tales-header">
    <div class="tales-logo">
      <h1>üì∞ The AutoBattler Chronicle</h1>
      <p class="tales-subtitle">Your Daily Source of Adventure & Missions</p>
    </div>
    <div class="tales-date">
      <span class="current-date">{{ talesData?.lastUpdated | date:'EEEE, MMMM d, y' }}</span>
      <span class="issue-number">Issue #{{ (talesData?.currentLore?.id || 1) + 100 }}</span>
    </div>
  </header>

  <!-- Loading State -->
  <div *ngIf="isLoading" class="loading-container">
    <div class="loading-spinner"></div>
    <p>Loading the latest tales...</p>
  </div>

  <!-- Error State -->
  <div *ngIf="errorMessage" class="error-container">
    <div class="error-icon">‚ö†Ô∏è</div>
    <h2>Chronicle Unavailable</h2>
    <p>{{ errorMessage }}</p>
    <button class="retry-button" (click)="loadTalesData()">Retry</button>
  </div>

  <!-- Main Content -->
  <div *ngIf="talesData && !isLoading" class="tales-content">
    
    <!-- Featured Story Section -->
    <section class="featured-story">
      <div class="story-header">
        <h2 class="story-title">{{ talesData.currentLore.title }}</h2>
        <div class="story-meta">
          <span class="author">By {{ talesData.currentLore.author }}</span>
          <span class="story-type">Weekly Lore</span>
        </div>
      </div>
      <div class="story-content" [innerHTML]="formatStoryContent(talesData.currentLore.content)"></div>
    </section>

    <!-- Missions Section -->
    <section class="missions-section">
      <div class="missions-header">
        <h2>üéØ Daily & Weekly Missions</h2>
        <p class="missions-subtitle">Complete missions to earn rewards and progress your adventure</p>
      </div>

      <!-- Daily Missions -->
      <div class="mission-category">
        <div class="category-header">
          <h3>üìÖ Daily Missions</h3>
          <div class="reset-timer" *ngIf="dailyResetTimer">
            <span class="timer-icon">‚è∞</span>
            <span class="timer-text">Resets in {{ dailyResetTimer }}</span>
          </div>
        </div>
        <div class="mission-grid">
          <div *ngFor="let mission of talesData.dailyMissions" 
               class="mission-card daily-mission" 
               [class.claimed]="isMissionClaimed(mission.id)"
               [class.completed]="isMissionCompleted(mission.id)">
            
            <div class="mission-header">
              <h4 class="mission-title">{{ mission.title }}</h4>
              <div class="mission-reward">
                <span class="reward-icon">{{ getRewardIcon(mission.rewardItem) }}</span>
                <span class="reward-amount">{{ mission.rewardAmount }}</span>
              </div>
            </div>

            <p class="mission-description">{{ mission.description }}</p>

            <div class="mission-progress">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="(getMissionProgress(mission.id) / 10) * 100"></div>
              </div>
              <span class="progress-text">{{ getMissionProgress(mission.id) }}/10</span>
            </div>

            <div class="mission-footer">
              <div class="mission-info">
                <span class="reward-type">{{ getRewardTypeText(mission.rewardType) }}</span>
                <span class="mission-status" *ngIf="isMissionClaimed(mission.id)">‚úì Claimed</span>
              </div>
              <div class="mission-actions">
                <button 
                  class="action-button claim-button" 
                  [disabled]="!isDailyMissionCompleted(mission.id) || isDailyMissionClaimed(mission.id)"
                  (click)="claimMission(mission.id, 'daily')">
                  Claim Reward
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Weekly Missions -->
      <div class="mission-category">
        <div class="category-header">
          <h3>üóìÔ∏è Weekly Missions</h3>
          <div class="reset-timer" *ngIf="weeklyResetTimer">
            <span class="timer-icon">‚è∞</span>
            <span class="timer-text">Resets in {{ weeklyResetTimer }}</span>
          </div>
        </div>
        <div class="mission-grid">
          <div *ngFor="let mission of talesData.weeklyMissions" 
               class="mission-card weekly-mission" 
               [class.claimed]="isMissionClaimed(mission.id)"
               [class.completed]="isMissionCompleted(mission.id)">
            
            <div class="mission-header">
              <h4 class="mission-title">{{ mission.title }}</h4>
              <div class="mission-reward">
                <span class="reward-icon">{{ getRewardIcon(mission.rewardItem) }}</span>
                <span class="reward-amount">{{ mission.rewardAmount }}</span>
              </div>
            </div>

            <p class="mission-description">{{ mission.description }}</p>

            <div class="mission-progress">
              <div class="progress-bar">
                <div class="progress-fill" [style.width.%]="(getMissionProgress(mission.id) / 20) * 100"></div>
              </div>
              <span class="progress-text">{{ getMissionProgress(mission.id) }}/20</span>
            </div>

            <div class="mission-footer">
              <div class="mission-info">
                <span class="reward-type">{{ getRewardTypeText(mission.rewardType) }}</span>
                <span class="mission-status" *ngIf="isMissionClaimed(mission.id)">‚úì Claimed</span>
              </div>
              <div class="mission-actions">
                <button 
                  class="action-button claim-button weekly-claim" 
                  [disabled]="!isWeeklyMissionCompleted(mission.id) || isWeeklyMissionClaimed(mission.id)"
                  (click)="claimMission(mission.id, 'weekly')">
                  Claim Reward
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Editorial Section -->
    <section class="editorial-section">
      <div class="editorial-header">
        <h3>üí≠ Editorial</h3>
      </div>
      <div class="editorial-content">
        <p class="editorial-quote">
          <em>"Why do we fight? Why do we battle? Is it for glory, for loot‚Äîor for the cheese?"</em>
        </p>
        <p class="editorial-text">
          Some say the true reward is the friends we block along the way. The Chronicle wishes you luck (and patience) in the Arena.
        </p>
      </div>
    </section>
  </div>

  <!-- Footer -->
  <footer class="tales-footer">
    <div class="footer-quote">
      "News is what someone wants suppressed. Everything else is advertising."<br>
      ‚Äî Lord Newsworth, 1894
    </div>
    <div class="footer-contact">
      Want your story in the Chronicle? Send tales, screenshots, and memes to <strong>news&#64;autobattler.fake</strong>
    </div>
    <div class="footer-copyright">
      &copy; 2025 The AutoBattler Chronicle ‚Äî All cheese rights reserved.
    </div>
  </footer>
</div>