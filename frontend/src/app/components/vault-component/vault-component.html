<div class="vault-root">
  <h1 class="vault-title">Vault</h1>
  <div class="vault-row redesign">
    <div class="vault-col vault-left">
      <section class="section-box stats-section" *ngIf="character as c">
        <h2 class="section-title">Stats</h2>
        <div class="stat-row" *ngFor="let s of ['attack','defense','agility','magic','speed','maxHealth']">
          <span class="stat-name">{{ s | titlecase }}</span>
          <span class="stat-values">
            <ng-container *ngIf="formatStatDisplayForUI(s).hasBonus; else simpleStat">
              {{ formatStatDisplayForUI(s).total }} <span class="stat-bonus">| {{ formatStatDisplayForUI(s).bonus }}</span>
            </ng-container>
            <ng-template #simpleStat>
              {{ formatStatDisplayForUI(s).total }}
            </ng-template>
          </span>
        </div>
      </section>

      <section class="section-box abilities-section" *ngIf="ownedAttacks.length">
        <h2 class="section-title">Abilities</h2>
        <div class="abilities-grid">
          <div class="ability-slot" *ngFor="let idx of [0,1,2,3]">
            <div class="slot-label">Slot {{ idx+1 }}</div>
            <div class="slot-body">
              <select (change)="changeAbilityAtIndex(idx, $any($event.target).value)">
                <option [value]="''">Empty</option>
                <option *ngFor="let a of ownedAttacks" [selected]="equippedAttackIds[idx]===a.id" [value]="a.id">{{ a.name }}</option>
              </select>
            </div>
          </div>
        </div>
        <div class="owned-abilities">
          <div class="owned-title">Owned</div>
          <div class="owned-list">
            <button class="ability-chip" *ngFor="let a of ownedAttacks" [class.equipped]="equippedAttackIds.includes(a.id)" (click)="toggleEquipAttack(a.id)">
              {{ a.name }}
            </button>
          </div>
        </div>
      </section>
    </div>

    <div class="vault-col vault-right" *ngIf="character as c">
      <section class="section-box mannequin-section">
        <h2 class="section-title">Equipment</h2>
        <div class="mannequin-wrap">
          <img [src]="'assets/characters/' + (c.profileIconUrl ? c.profileIconUrl.split('/').pop() : 'char1.jpeg')" class="mannequin" alt="Character" (error)="onImageError($event)" />
          <div class="slot head">
            <div class="slot-label">Head</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('head') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('head', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('head')" [selected]="(getEquippedItem('head')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('head')" (click)="unequip('head')">Remove</button>
            </div>
          </div>
          <div class="slot weapon">
            <div class="slot-label">Weapon</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('weapon') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('weapon', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('weapon')" [selected]="(getEquippedItem('weapon')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('weapon')" (click)="unequip('weapon')">Remove</button>
            </div>
          </div>
          <div class="slot chest">
            <div class="slot-label">Chest</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('chest') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('chest', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('chest')" [selected]="(getEquippedItem('chest')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('chest')" (click)="unequip('chest')">Remove</button>
            </div>
          </div>
          <div class="slot legs">
            <div class="slot-label">Legs</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('legs') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('legs', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('legs')" [selected]="(getEquippedItem('legs')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('legs')" (click)="unequip('legs')">Remove</button>
            </div>
          </div>
          <div class="slot arms">
            <div class="slot-label">Arms</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('arms') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('arms', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('arms')" [selected]="(getEquippedItem('arms')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('arms')" (click)="unequip('arms')">Remove</button>
            </div>
          </div>
          <div class="slot hands">
            <div class="slot-label">Hands</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('hands') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('hands', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('hands')" [selected]="(getEquippedItem('hands')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('hands')" (click)="unequip('hands')">Remove</button>
            </div>
          </div>
          <div class="slot feet">
            <div class="slot-label">Feet</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('feet') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('feet', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('feet')" [selected]="(getEquippedItem('feet')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('feet')" (click)="unequip('feet')">Remove</button>
            </div>
          </div>
          <div class="slot belt">
            <div class="slot-label">Belt</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('belt') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('belt', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('belt')" [selected]="(getEquippedItem('belt')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('belt')" (click)="unequip('belt')">Remove</button>
            </div>
          </div>
          <div class="slot back">
            <div class="slot-label">Back</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('back') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('back', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('back')" [selected]="(getEquippedItem('back')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('back')" (click)="unequip('back')">Remove</button>
            </div>
          </div>
          <div class="slot ring">
            <div class="slot-label">Ring</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('ring') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('ring', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('ring')" [selected]="(getEquippedItem('ring')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('ring')" (click)="unequip('ring')">Remove</button>
            </div>
          </div>
          <div class="slot amulet">
            <div class="slot-label">Amulet</div>
            <div class="slot-content">
              <img *ngIf="getEquippedItem('amulet') as item" [src]="item.imageUrl" class="slot-icon" alt="{{item.name}}" />
              <select (change)="equip('amulet', $any($event.target).value)">
                <option value="">Choose...</option>
                <option *ngFor="let it of itemsForSlot('amulet')" [selected]="(getEquippedItem('amulet')?.id)===it.id" [value]="it.id">{{ it.name }}</option>
              </select>
              <button *ngIf="getEquippedItem('amulet')" (click)="unequip('amulet')">Remove</button>
            </div>
          </div>
        </div>
      </section>

      <section class="section-box inventory-section">
        <h2 class="section-title">Inventory</h2>
        <div *ngIf="unequippedInventory.length === 0" class="inventory-empty">No unequipped items in your inventory.</div>
        <ul class="inventory-list" *ngIf="unequippedInventory.length > 0">
          <li class="inventory-item" *ngFor="let item of unequippedInventory">
            <img [src]="item.ImageUrl || item.imageUrl" class="inv-icon" alt="{{ item.Name || item.name }}" />
            <div class="inv-details">
              <div class="inv-name">{{ item.Name || item.name }}</div>
              <div class="inv-type">{{ (item.Type || item.type) }} â€” Slot: {{ (item.Slot || item.slot) }}</div>
              <div class="inv-stats" *ngIf="(item.StatBonuses || item.statBonuses) as sb">
                <span *ngFor="let kv of (sb | keyvalue); let last = last">
                  {{ kv.key }} +{{ kv.value }}<span *ngIf="!last">, </span>
                </span>
              </div>
            </div>
            <div class="inv-qty" *ngIf="(item.Quantity || item.quantity) > 1">x{{ item.Quantity || item.quantity }}</div>
            <div>
              <button (click)="equip((item.Slot || item.slot).toLowerCase(), (item.Id || item.id))">Equip</button>
            </div>
          </li>
        </ul>
      </section>
    </div>
  </div>
</div>
